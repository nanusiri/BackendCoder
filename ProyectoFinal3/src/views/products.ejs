<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Lista de Productos</h1>

    <!-- Controles de Filtrado, Paginación y Ordenamiento -->
    <form action="/api/products" method="GET">
        <label for="limit">Mostrar:</label>
        <select name="limit" id="limit">
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="50">50</option>
        </select>

        <label for="sort">Orden precio:</label>
        <select name="sort" id="sort">
            <option value="asc">Ascendente</option>
            <option value="desc">Descendente</option>
        </select>

        <label for="category">Categoría:</label>
        <input type="text" name="category" id="category">

        <button type="submit">Filtrar</button>
    </form>

    <!-- Lista de Productos -->
    <div>
        <% if (result.docs.length> 0) { %>
            <ul>
                <% result.docs.forEach(producto=> { %>
                    <li id="productDetail" data-product-id="<%= producto.producto%>">
                        <strong>
                            <%= producto.productTitle %>
                        </strong>
                        <p>Categoría: <%= producto.productCategory %>
                        </p>
                        <p>Precio: $<%= producto.productPrice %>
                        </p>

                        <div style="display: flex; ">
                            <button onclick="decrementar('contador')">-</button>
                            <p id="contador" style="margin: 0 10px; font-size: 20px;">1</p>
                            <button onclick="incrementar('contador')">+</button>
                        </div>
                        <br>
                        <button id="agregarCarrito">Agregar al carrito</button>
                    </li>
                    <hr>
                    <% }); %>
            </ul>

            <!-- Controles de Paginación -->
            <div>
                <% if (result.hasPrevPage) { %>
                    <a href="?page=<%= result.prevPage %>">Anterior</a>
                    <% } %>

                        Página <%= result.page %> de <%= result.totalPages %>

                                <% if (result.hasNextPage) { %>
                                    <a href="?page=<%= result.nextPage %>">Siguiente</a>
                                    <% } %>
            </div>
            <% } else { %>
                <p>No se encontraron productos.</p>
                <% } %>
    </div>

    <script>
        function incrementar(id) {
            var contador = document.getElementById(id);
            contador.textContent = parseInt(contador.textContent) + 1;
        }

        function decrementar(id) {
            var contador = document.getElementById(id);
            var valor = parseInt(contador.textContent);
            if (valor > 1) {
                contador.textContent = valor - 1;
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('agregarCarrito').addEventListener('click', function (event) {
                event.preventDefault()

                const cantidad = document.getElementById('contador').textContent

                const pid = document.getElementById('productDetail').getAttribute('data-product-id')

                agregarAlCarrito(pid, cantidad)
            })

            async function agregarAlCarrito(pid, cantidad) {
                try {
                    const response = await fetch(`/api/carts/:cid/product/${pid}`)
                } catch (error) {

                }
            }
        })    
    </script>
</body>

</html>